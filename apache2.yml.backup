---
- hosts: webservers
  tasks:
    - name: install apache2 klient1 Debian 12
      apt:
        name: apache2
        update_cache: yes
        state: latest
      when: ansible_os_family == "Debian"

    - name: install apache2 klient2 CentOS
      dnf:
        name: httpd
        update_cache: yes
        state: latest
      when: ansible_os_family == "RedHat"

    - name: enable and start httpd on CentOS
      service:
        name: httpd
        state: started
        enabled: yes
      when: ansible_os_family == "RedHat"

    - name: allow http traffic in firewall on CentOS
      firewalld:
        service: http
        permanent: yes
        state: enabled
        immediate: yes
      when: ansible_os_family == "RedHat"

    - name: Muudame home user kataloogi õigused
      file:
        path: /home/user/
        mode: 0711

    - name: Loome public_html kataloogi userile
      file:
        path: /home/user/public_html
        owner: user
        group: user
        mode: 0755
        state: directory

    - name: Lubame userdir mod
      apache2_module:
        name: userdir
        state: present
      when: ansible_os_family == "Debian"

    - name: Lubame userdir conf faili sisu
      lineinfile:
        dest: /etc/apache2/mods-enabled/userdir.conf
        regexp: "Require method GET POST OPTIONS"
        line: "Require all granted"
      when: ansible_os_family == "Debian"

    - name: Kopeerime index.html faili userile  home publichtml kataloogi
      copy:
        src: /var/www/html/index.html
        dest: /home/user/public_html/
        remote_src: yes
        owner: user
        group: user
      when: ansible_os_family == "Debian"

    - name: user index html redigeerimine
      lineinfile:
        dest: /home/user/public_html/index.html
        regexp: "Apache2 Debian Default Page"
        line: "USERi lehekülg"
        state: present
      when: ansible_os_family == "Debian"

  handlers:
    - name: Apache serverile alglaadimine
      service:
        name: apache2
        state: restarted
      when: ansible_os_family == "Debian"

